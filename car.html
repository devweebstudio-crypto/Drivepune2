<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Car Details</title>

<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        background: #f5f5f5;
    }
    header {
        background: #111;
        color: white;
        padding: 15px;
        text-align: center;
        font-size: 20px;
    }
    .container {
        max-width: 900px;
        margin: auto;
        padding: 15px;
    }

    /* Image Slider */
    .slider {
        position: relative;
        width: 100%;
        height: 220px;
        background: #eee;
        border-radius: 8px;
        overflow: hidden;
    }
    .slider img {
        width: 100%;
        height: 220px;
        object-fit: cover;
    }
    .slider-btn {
        position: absolute;
        top: 50%;
        background: rgba(0,0,0,0.5);
        color: white;
        border: none;
        padding: 10px;
        cursor: pointer;
        border-radius: 50%;
        transform: translateY(-50%);
    }
    .left-btn { left: 10px; }
    .right-btn { right: 10px; }

    .details {
        margin-top: 20px;
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .btn {
        background: #111;
        color: white;
        padding: 12px 20px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        margin-top: 15px;
        font-size: 15px;
    }
    .btn:hover { background: #333; }

    /* Modal */
    #enquiryModal {
        display: none;
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.6);
        justify-content: center;
        align-items: center;
    }
    .modal-content {
        background: white;
        width: 90%;
        max-width: 400px;
        padding: 20px;
        border-radius: 8px;
    }
    .modal-content input {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        margin: 8px 0;
        border-radius: 6px;
    }
</style>
</head>

<body>

<header>Car Details</header>

<div class="container">

    <div class="slider">
        <button class="slider-btn left-btn" onclick="prevImage()">❮</button>
        <img id="mainImage" src="">
        <button class="slider-btn right-btn" onclick="nextImage()">❯</button>
    </div>

    <div class="details">
        <h2 id="carName">Loading...</h2>
        <p id="carDescription"></p>

        <p><b>Fuel:</b> <span id="fuel"></span></p>
        <p><b>Seating:</b> <span id="seat"></span></p>
        <p><b>Transmission:</b> <span id="transmission"></span></p>
        <p><b>Price:</b> ₹<span id="price"></span>/day</p>

        <button class="btn" onclick="openModal()">Enquiry Now</button>
    </div>

</div>

<!-- Modal -->
<div id="enquiryModal">
    <div class="modal-content">
        <span style="float:right;cursor:pointer;" onclick="closeModal()">✖</span>
        <h3>Enquiry Now</h3>

        <input type="text" id="qName" placeholder="Your Name">
        <input type="text" id="qPhone" placeholder="Mobile Number">
        <input type="date" id="qStart">
        <input type="date" id="qEnd">
        <input type="text" id="qLocation" placeholder="Location (optional)">
        <button class="btn" onclick="submitEnquiry()">Submit</button>
    </div>
</div>

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
// Supabase init
const SUPABASE_URL = "https://diqgdlodnjtuekouxjsz.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRpcWdkbG9kbmp0dWVrb3V4anN6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzNzMwMDksImV4cCI6MjA3ODk0OTAwOX0.aK_CKsaEfHxYKvR68xDpWglkvNr5GxkiNNKqleR_mzA";
const db = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// Get car ID from URL
const urlParams = new URLSearchParams(window.location.search);
const carId = urlParams.get("id");

let imageList = [];
let currentIndex = 0;

// Load car details
async function loadCar() {
    const { data, error } = await db
        .from("cars")
        .select("*, car_images(image_url)")
        .eq("id", carId)
        .single();

    if (error || !data) {
        document.querySelector(".details").innerHTML = "<h3>Car not found</h3>";
        return;
    }

    // Set text details
    document.getElementById("carName").innerText = data.name;
    document.getElementById("carDescription").innerText = data.description || "";
    document.getElementById("fuel").innerText = data.fuel_type;
    document.getElementById("seat").innerText = data.seating;
    document.getElementById("transmission").innerText = data.transmission;
    document.getElementById("price").innerText = data.price_per_day;

    // Image Slider
    imageList = data.car_images.map(i => i.image_url);

    if (imageList.length === 0) {
        imageList = ["https://placehold.co/600x400"];
    }

    document.getElementById("mainImage").src = imageList[0];
}

// Slider functions
function nextImage() {
    currentIndex = (currentIndex + 1) % imageList.length;
    document.getElementById("mainImage").src = imageList[currentIndex];
}

function prevImage() {
    currentIndex = (currentIndex - 1 + imageList.length) % imageList.length;
    document.getElementById("mainImage").src = imageList[currentIndex];
}

// Modal
function openModal() {
    document.getElementById("enquiryModal").style.display = "flex";
}

function closeModal() {
    document.getElementById("enquiryModal").style.display = "none";
}

// Submit enquiry
async function submitEnquiry() {
    const name = document.getElementById("qName").value.trim();
    const phone = document.getElementById("qPhone").value.trim();
    const start = document.getElementById("qStart").value;
    const end = document.getElementById("qEnd").value;
    const location = document.getElementById("qLocation").value.trim();

    if (!name || !phone || !start || !end) {
        alert("Please fill all required fields.");
        return;
    }

    const { error } = await db.from("bookings").insert({
        car_id: carId,
        name,
        phone,
        start_date: start,
        end_date: end,
        location
    });

    if (error) {
        alert("Failed to submit enquiry");
    } else {
        alert("Enquiry submitted successfully!");
        closeModal();
    }
}

loadCar();
</script>

</body>
</html>
